## äº‹ä»¶æ‹¦æˆªæ–¹æ¡ˆ
### æ­£äº¤çš„æ»‘åŠ¨å†²çª
ä¸€èˆ¬å†…å±‚`View`å’Œå¤–å±‚`View`éƒ½å¯ä»¥æ»‘åŠ¨æ—¶ï¼Œå¯¹äºåˆ†åˆ«å“åº”`X`è½´å’Œ`Y`è½´çš„æ»‘åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œé€šè¿‡æ»‘åŠ¨è§’åº¦æˆ–è€…`x`æˆ–`y`çš„æ»‘åŠ¨é•¿åº¦æ¥å¾—çŸ¥æ˜¯æ¨ªå‘æ»‘åŠ¨è¿˜æ˜¯çºµå‘æ»‘åŠ¨ï¼Œä»è€Œå¤„ç†å†…å¤–å±‚çš„æ»‘åŠ¨å†²çªã€‚æ­£äº¤æ–¹å‘çš„æ»‘åŠ¨å†²çªå¤„ç†æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œåªå¤§æ¦‚æè¿°ã€‚

**ä¸€èˆ¬ä½¿ç”¨å¤–éƒ¨æ‹¦æˆªæ³•ï¼Œå› ä¸ºå†…éƒ¨æ‹¦æˆªæ³•è¦åŒæ—¶é‡å†™å†…å¤–å±‚ï¼Œè€¦åˆåº¦å¤ªé«˜**

* å¤–éƒ¨æ‹¦æˆªæ³•ï¼šåœ¨å¤–å±‚çš„`onInterceptTouchEvent`æ–¹æ³•ä¸­ï¼Œ`move`äº‹ä»¶æ—¶å¦‚æœå¤–å±‚éœ€è¦æ­¤äº‹ä»¶åˆ™æ‹¦æˆªï¼Œç„¶åç”±å¤–å±‚å¤„ç†ã€‚æ¯”å¦‚å¤–å±‚æ˜¯çºµå‘æ»‘åŠ¨ï¼Œé‚£ä¹ˆæ£€æµ‹åˆ°æ˜¯çºµå‘æ»‘åŠ¨å°±æ‹¦æˆªã€‚
* å†…éƒ¨æ‹¦æˆªæ³•ï¼šåœ¨å†…å±‚çš„`dispatchTouchEvent`ä¸­ï¼Œ`down`äº‹ä»¶ç¦æ­¢å¤–å±‚æ‹¦æˆªï¼Œåœ¨moveäº‹ä»¶æ—¶åˆ¤æ–­å¤–å±‚éœ€è¦æ­¤äº‹ä»¶ï¼Œåˆ™å…è®¸å¤–å±‚æ‹¦æˆªï¼Œè€Œå¤–å±‚çš„`onInterceptTouchEvent`ä¸­åªè¦ä¸æ˜¯downäº‹ä»¶å°±æ‹¦æˆªï¼Œæ‰€ä»¥åªè¦å†…å±‚å…è®¸æ‹¦æˆªå¤–å±‚å°±ä¼šæ‹¦æˆªã€‚

### åŒå‘çš„æ»‘åŠ¨å†²çª
æ¯”å¦‚ç«–ç›´æ»‘åŠ¨çš„å®¹å™¨å†…éƒ¨æœ‰ä¸€ä¸ª`header`å’Œä¸€ä¸ª`ScrollView`ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š
* 1.å†…éƒ¨`ScrollView`æ‰‹æŒ‡ä¸‹æ‹‰ä½¿å…¶æ»‘åŠ¨åˆ°é¡¶éƒ¨æ—¶ï¼Œåº”è¯¥è®©å¤–éƒ¨å®¹å™¨æ¥ç®¡äº‹ä»¶ï¼Œéœ²å‡º`header`ã€‚
* 2.æ‰‹æŒ‡ä¸Šæ‹‰ä½¿`header`å®Œå…¨éšè—åï¼Œè¿™æ—¶åº”è¯¥å†æ¬¡è®©å†…éƒ¨`ScrollView`æ¥å¤„ç†äº‹ä»¶ã€‚

è¿™é‡Œæˆ‘ä»¬åŒæ ·ä½¿ç”¨å¤–éƒ¨æ‹¦æˆªæ³•ï¼Œä½†æ­£å¸¸æƒ…å†µä¸‹æ‹¦æˆªåchildä¸èƒ½å†å¤„ç†äº‹ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸Šæ‹‰ä½¿`header`å®Œå…¨éšè—åï¼Œå†…éƒ¨childæ— æ³•å†å¤„ç†äº‹ä»¶è€Œæ»‘åŠ¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ­¤æ—¶å†ç»™å†…éƒ¨`ScrollView`å¼ºè¡Œåˆ†å‘ä¸€ä¸ª`down`äº‹ä»¶ï¼Œä½¿å†…éƒ¨é‡æ–°æ¥ç®¡äº‹ä»¶ã€‚

å¸ƒå±€æ˜¯`CustomViewGroup` å†…éƒ¨ç¬¬ä¸€ä¸ªæ˜¯headerï¼Œé«˜50dpï¼Œç¬¬äºŒä¸ªæ˜¯ScrollViewã€‚å¸ƒå±€åˆå§‹å°±scrollYä¸º50dpï¼Œä»¥éšè—headerã€‚è¿™é‡Œä¸»è¦å±•ç¤ºæ‹¦æˆªå’Œå¼ºè¡Œåˆ†å‘çš„é€»è¾‘ï¼ˆä»£ç åªä¸ºç®€å•å±•ç¤ºæ ¸å¿ƒé€»è¾‘ï¼Œæ²¡æœ‰è¿‡å¤šæ£€æŸ¥å„ç§é€»è¾‘åˆ¤å®šçš„ä¸¥è°¨æ€§ï¼Œå®é™…å¼€å‘ä¸­åº”å½“å‚è€ƒandroidå®˜æ–¹ç»„ä»¶ï¼‰ã€‚

```
public class CustomViewGroup extends LinearLayout {
    private int mLastY;//ä¸Šä¸€ä¸ªYåæ ‡
    private int mInitialDownY;//åˆæ¬¡æŒ‰ä¸‹æ—¶çš„Yåæ ‡

    @Override
    public boolean onInterceptTouchEvent(MotionEvent ev) {
        //å¦‚æœScrollViewè¿˜æ²¡æœ‰æ»‘åŠ¨åˆ°é¡¶éƒ¨å°±ä¸æ‹¦æˆª
        //RecyclerViewç­‰å…¶ä»–æ»‘åŠ¨æ§ä»¶åˆ¤å®šæ˜¯å¦æ»‘åŠ¨åˆ°é¡¶éƒ¨çš„æ–¹å¼ä¸åŒï¼Œéœ€å…·ä½“è€Œå®šï¼‰
        if (getChildAt(1).canScrollVertically(-1)) {
            return false;
        }

        boolean intercepted = false;
        int y = (int) ev.getY();
        switch (ev.getActionMasked()) {
            case MotionEvent.ACTION_DOWN:
                mInitialDownY = y;//ä¿å­˜æŒ‰ä¸‹çš„Yåæ ‡
                break;
            case MotionEvent.ACTION_MOVE:
                final float yDiff = y - mInitialDownY;
                //è¿›å…¥è¿™é‡Œè¯´æ˜å†…å±‚å·²æ»‘åŠ¨åˆ°é¡¶éƒ¨
                //yDiff > touchSlopè¡¨æ˜æ˜¯æ­£æ•°ä¸”å¤§äºæœ€å°æ»‘åŠ¨åˆ¤æ–­ï¼Œ
                //è¯´æ˜æ˜¯æ‰‹æŒ‡ä¸‹æ‹‰ï¼Œè¿™æ—¶å°±æ‹¦æˆªäº‹ä»¶è‡ªå·±å¤„ç†
                if (yDiff > ViewConfiguration.getTouchSlop()) {
                    mLastY = mInitialDownY;
                    intercepted = true;
                }
                break;
            case MotionEvent.ACTION_UP://ä¸ºé€»è¾‘ç®€å•ï¼Œè¿™é‡Œéƒ½ä¸ç®¡upå’Œdownçš„ç»†èŠ‚
                break;
        }
        return intercepted;
    }

    @Override
    public boolean onTouchEvent(MotionEvent event) {
        int y = (int) event.getY();
        switch (event.getActionMasked()) {
            case MotionEvent.ACTION_DOWN:
                break;
            case MotionEvent.ACTION_MOVE:
                //è¿™é‡Œç”¨æ»‘åŠ¨Yåæ ‡åˆ°æŒ‰ä¸‹çš„ä½ç½®çš„ä¸Šé¢ä½œä¸ºheaderå®Œå…¨éšè— 
                //ï¼ˆä¹Ÿå°±æ˜¯å†…å±‚é¡¶éƒ¨å’Œå¤–å±‚é¡¶éƒ¨ä¸€è‡´æ—¶ï¼‰çš„åˆ¤æ–­ä¾æ®ï¼Œå®é™…ä»£ç å…·ä½“è€Œå®š
                if (y <= mInitialDownY) {
                    //ä½¿ç”¨y <= mInitialDownYä¼šæœ‰è¯¯å·®ï¼Œæ‰€ä»¥è¦è°ƒç”¨scrollToä½¿
                    //å†…å±‚çš„é¡¶éƒ¨å’Œå¤–å±‚é¡¶éƒ¨ä½ç½®ä¸€è‡´ï¼Œå®é™…ä½¿ç”¨æ—¶åº”è¯¥æƒ³ç‚¹æ›´å¥½çš„åˆ¤å®šæ–¹å¼
                    scrollTo(0, dip2px(50f));
                    event.setAction(MotionEvent.ACTION_DOWN);
                    //å¼ºè¡Œåˆ†å‘downäº‹ä»¶ï¼Œä½¿å†…å±‚é‡æ–°å¼€å§‹å¤„ç†
                    dispatchTouchEvent(event);
                    break;
                }
                int deltaY = y - mLastY;
                scrollBy(0, -deltaY);//headeræ²¡æœ‰å®Œå…¨éšè—æ—¶åˆ™æ­£å¸¸æ»‘åŠ¨å¤–å±‚
                break;
            case MotionEvent.ACTION_UP:
            case MotionEvent.ACTION_CANCEL:
                break;
        }
        mLastY = y;
        return true;
    }

    @Override
    public void requestDisallowInterceptTouchEvent(boolean disallowIntercept) {
         //ä½¿å†…éƒ¨æ— æ³•ç¦æ­¢å¤–å±‚æ‹¦æˆª
    }
```
> å¯ä»¥çœ‹å‡ºè¿™ç§æ–¹å¼æœ‰ç‚¹hackã€‚ä¹Ÿæœ‰ä¸é‡å†™onInterceptTouchEventè€Œå®Œå…¨é‡å†™dispatchTouchEventçš„æ–¹å¼ï¼Œè¯¥æ‹¦æˆªæ—¶å°±ä¸åˆ†å‘ï¼Œè¯¥åˆ†å‘å°±åˆ†å‘ã€‚

> è§¦æ‘¸äº‹ä»¶åˆ†å‘ä¸­ï¼ŒViewGroupåœ¨é¦–æ¬¡downäº‹ä»¶æ—¶ï¼Œä¼šé‡ç½®requestDisallowInterceptTouchEventè®¾ç½®çš„æ ‡å¿—ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬è°ƒç”¨requestDisallowInterceptTouchEventçš„æ—¶æœºéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚æ¯”å¦‚åœ¨åˆå§‹åŒ–ViewGroupå®ä¾‹æ—¶å°±è°ƒç”¨æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼Œå› ä¸ºåœ¨è§¦æ‘¸äº‹ä»¶å¼€å§‹æ—¶ä¼šè¢«é‡ç½®ã€‚

## å®˜æ–¹NestedScrollingæ–¹æ¡ˆ
`Android 5.0`å¼€å§‹å®˜æ–¹æä¾›äº†`NestedScrolling`æœºåˆ¶ç”¨äºåµŒå¥—æ»‘åŠ¨ã€‚åœ¨äº‹ä»¶æ‹¦æˆªæ–¹æ¡ˆä¸­ï¼Œparentæ˜¯ä¸»åŠ¨æ–¹ï¼Œç”±parenté€šè¿‡æ‹¦æˆªæ§åˆ¶è°å¤„ç†äº‹ä»¶ï¼Œè€Œåœ¨`NestedScrolling`æœºåˆ¶ä¸­ï¼Œchildæˆä¸ºäº†ä¸»åŠ¨æ–¹ï¼Œæ›´åŠ ç¬¦åˆå®é™…äº¤äº’ä¸­childä¼˜å…ˆçš„æƒ…å†µã€‚

å…ˆé€šè¿‡ä¸€ä¸ªåœºæ™¯æ¥æå‰äº†è§£ä¸€ä¸‹NestedScrollingçš„å¤§è‡´æ€æƒ³ï¼šchildå’Œparentéƒ½æ˜¯çºµå‘æ»‘åŠ¨çš„æ§ä»¶ï¼Œchildå¾€ä¸Šæ»‘åŠ¨ï¼ˆæ‰‹æŒ‡å¾€ä¸‹æ‹‰ï¼‰ï¼Œå…ˆè¯¢é—®parentï¼šæˆ‘è¦å‡†å¤‡å¾€ä¸Šæ»šåŠ¨äº†10pxï¼›parentå›å¤childï¼šä½ æ‰§è¡Œå§ï¼Œæˆ‘ä¸åšå¤„ç†ï¼›childå®Œæˆæ»šåŠ¨ï¼Œä½†åªæ»šåŠ¨äº†5pxå°±åˆ°äº†é¡¶éƒ¨ï¼Œchildå‘Šè¯‰parentï¼šæˆ‘æ»šåŠ¨äº†5pxï¼Œè¿˜å‰©5pxï¼Œä½†æˆ‘åˆ°é¡¶éƒ¨äº†ï¼Œä¸èƒ½å†æ¶ˆè´¹æ»šåŠ¨è·ç¦»çš„ï¼Œä½ æ¥å¤„ç†å‰©ä½™çš„å§ï¼›parentæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œè‡ªå·±æ»šåŠ¨äº†5pxï¼Œç„¶åå‘Šè¯‰childï¼šæˆ‘æŠŠ5pxéƒ½æ»šåŠ¨äº†ã€‚

åœ¨`NestedScrolling`ä¸­ï¼Œåˆ†ä¸ºchildå’Œparentä¸¤ä¸ªè§’è‰²ï¼Œåˆ†åˆ«å¯¹åº”åµŒå¥—æ»‘åŠ¨çš„å†…å±‚å’Œå¤–å±‚viewï¼Œä½†å¹¶ä¸ä¸€å®šæ˜¯ç›´æ¥çš„çˆ¶å­viewå…³ç³»ã€‚childå’Œparentä¸¤ä¸ªè§’è‰²åˆ†åˆ«è¦å®ç°ä¸€å¥—æ¥å£ï¼Œç”¨äºåµŒå¥—æ»‘åŠ¨æ—¶ç›¸äº’é€šä¿¡ã€‚æ¥å£åˆ†åˆ«æ˜¯`NestedScrollingChild`å’Œ`NestedScrollingParent`ï¼Œä½äºandroidxåº“ä¸­ï¼Œå› ä¸º`NestedScrolling`æœ‰ç‰ˆæœ¬æ›´æ–°ï¼Œéƒ¨åˆ†æ–¹æ³•å¢åŠ å‚æ•°ï¼Œä½†å·®åˆ«ä¸å¤§ï¼Œç›®å‰æœ€æ–°æ˜¯ç¬¬ä¸‰ç‰ˆã€‚Android Frameworkä¸­çš„Viewå’ŒViewGroupæ²¡æœ‰æ˜¾å¼å£°æ˜å®ç°æ¥å£ï¼Œä½†ä¹Ÿå®é™…å®ç°äº†è¿™äº›æ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•å¹¶æ²¡æœ‰è·Ÿéšandroidxåº“çš„`NestedScrolling`ç›¸å…³æ¥å£åŒæ­¥æ–°å¢æ›´æ–°çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å‘çš„æ—¶å€™æœ€å¥½è¿˜æ˜¯ä½¿ç”¨androidxåº“ä¸­çš„æ¥å£ï¼Œè€Œä¸æ˜¯Android Frameworkä¸­çš„Viewå’ŒViewGroupçš„è‡ªå¸¦æ–¹æ³•ã€‚

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ¥å£çš„å†…å®¹ï¼Œè¿™é‡Œä¸ç†è§£æ²¡å…³ç³»ï¼Œçœ‹å®Œæ¥å£å†…å®¹åï¼Œä¼šä»‹ç»å…·ä½“çš„ç”¨æ³•ã€‚
1. NestedScrollingChild
è¿™é‡Œä»¥æœ€æ–°çš„NestedScrollingChild3ä¸ºä¾‹ï¼š
```
// è®¾ç½®æ˜¯å¦å¯ç”¨åµŒå¥—æ»‘åŠ¨
void setNestedScrollingEnabled(boolean enabled);
boolean isNestedScrollingEnabled();

// å½“åµŒå¥—æ»‘åŠ¨å¼€å§‹äº§ç”Ÿæ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé€šå¸¸åœ¨ACTION_DOWNé‡Œé¢è°ƒç”¨ï¼Œä¼šå»å¯»æ‰¾`parent`ï¼ˆä¸ä¸€å®šæ˜¯ç›´æ¥`parent`ï¼‰å¤„ç†ï¼Œ
// axesï¼šæ»‘åŠ¨çš„æ–¹å‘ï¼Œæ¨ªå‘å’Œçºµå‘
// typeï¼šæ»šåŠ¨ç±»å‹ï¼Œè§¦æ‘¸æ»šåŠ¨å’Œéè§¦æ‘¸æ»šåŠ¨ï¼Œéè§¦æ‘¸çš„æ»šåŠ¨å®é™…å°±æ˜¯flingï¼Œä¹Ÿå°±æ˜¯æƒ¯æ€§æ»‘åŠ¨
boolean startNestedScroll(@ScrollAxis int axes, @NestedScrollType int type);

// è¿”å›trueè¡¨ç¤ºæœ‰å¤„ç†åµŒå¥—æ»‘åŠ¨çš„`parent`ã€‚åµŒå¥—æ»šåŠ¨`parent`çš„å­˜åœ¨è¡¨ç¤ºæ­¤è§†å›¾å·²å¯åŠ¨åµŒå¥—æ»šåŠ¨ï¼Œå¹¶ä¸”å·²è¢« `parent`ï¼ˆä¸ä¸€å®šæ˜¯ç›´æ¥`parent`ï¼‰æ¥å—ã€‚å®é™…å°±æ˜¯åœ¨`parent`çš„ `onStartNestedScroll`è¿”å›`true`åï¼Œæ­¤æ–¹æ³•å°±ä¼šè¿”å›`true`ï¼ŒåŸå› å¯è§`startNestedScroll`æºç ã€‚
boolean hasNestedScrollingParent(@NestedScrollType int type);

// childæ»‘åŠ¨ï¼ˆä¸€æ­¥æ»‘åŠ¨ï¼Œå¹¶éæ•´ä¸ªæ»‘åŠ¨è¿‡ç¨‹ï¼‰å‰ï¼Œæä¾›ç»™parentæ¶ˆè´¹éƒ¨åˆ†æˆ–å…¨éƒ¨æ»šåŠ¨æ“ä½œçš„æ—¶æœºã€‚ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼Œparentä¸ä¼šå…ˆä¸»åŠ¨æ¶ˆè´¹ï¼Œç›®å‰åªçœ‹åˆ°SwipeRefreshLayoutä¼šæ¶ˆè´¹ï¼‰
// å…¶ä»–å‚æ•°å®¹æ˜“æ˜ç™½ä½œç”¨ï¼ŒoffsetInWindowéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚è°ƒç”¨dispatchNestedPreScrollåï¼Œparentçš„onNestedPreScrollä¼šè¢«è°ƒç”¨ï¼Œåœ¨onNestedPreScrollå†…ï¼Œparentå¯èƒ½ä¼šæ»šåŠ¨ï¼Œå¯¼è‡´childçš„ä½ç½®äº§ç”Ÿåç§»ï¼Œ
// åœ¨onNestedPreScrollå‰åè®°å½•childçš„ä½ç½®ï¼Œè®¡ç®—å·®å€¼ã€‚è¿™ä¸ªå·®å€¼ä¼šç”¨äºchildè°ƒæ•´å†…éƒ¨çš„åæ ‡è®¡ç®—ï¼Œæ¯”å¦‚è®°å½•æœ¬æ¬¡è§¦æ‘¸äº‹ä»¶Yåæ ‡ä¸º100ï¼Œç»è¿‡parentçš„onNestedPreScrollåï¼Œå¯¼è‡´childçš„çºµå‘ä½ç½®äº§ç”Ÿäº†+50çš„åç§»ï¼Œé‚£ä¹ˆåº”è¯¥è°ƒæ•´æœ¬æ¬¡Yåæ ‡ä¸º100-50=50ï¼Œå› ä¸ºç°åœ¨æ‰‹æŒ‡ç›¸å¯¹äºchildçš„ä½ç½®åº”è¯¥æ˜¯50ï¼›åœ¨è®¡ç®—æ‰‹æŒ‡æ»‘åŠ¨é€Ÿåº¦ä¸Šï¼Œä¹Ÿä¼šä½¿ç”¨ã€‚
boolean dispatchNestedPreScroll(int dx, int dy, @Nullable int[] consumed,
            @Nullable int[] offsetInWindow, @NestedScrollType int type);

// childæ»‘åŠ¨ï¼ˆåŒä¸Šï¼‰åï¼Œå‘Šè¯‰parentè‡ªå·±çš„æ»‘åŠ¨æƒ…å†µï¼Œå¦‚æœè¿˜æœ‰å‰©ä½™ï¼Œparentè¿˜å¯ä»¥å†å¤„ç†
boolean dispatchNestedScroll(int dxConsumed, int dyConsumed,
        int dxUnconsumed, int dyUnconsumed, @Nullable int[] offsetInWindow,
        @NestedScrollType int type);

// childå¤„ç†flingå‰ï¼Œå…ˆé€šçŸ¥parentã€‚parentæ¶ˆè´¹äº†flingåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false
boolean dispatchNestedPreFling(float velocityX, float velocityY)ä¸ä¸Šè¿°åµŒå¥—æ»‘åŠ¨ç±»ä¼¼

// childé€šçŸ¥parentï¼Œè‡ªå·±æ˜¯å¦æ¶ˆè´¹flingã€‚
boolean dispatchNestedFling(float velocityX, float velocityY, boolean consumed)

// ç»“æŸåµŒå¥—æ»‘åŠ¨ï¼Œé€šå¸¸åœ¨upæˆ–canceläº‹ä»¶ä¸­è°ƒç”¨
void stopNestedScroll(@NestedScrollType int type);
```

2. NestedScrollingParent
æœ€æ–°çš„NestedScrollingParent3å¯¹åº”æ¥å£
```
// æ˜¯å¦æ¥å—childçš„åˆå§‹åµŒå¥—æ»šåŠ¨æ“ä½œï¼Œä¸€èˆ¬æ ¹æ®æ»šåŠ¨æ–¹å‘æ˜¯å¦ç¬¦åˆæ¥åˆ¤æ–­ï¼Œæˆ–è€…å…¶ä»–å…·ä½“æƒ…å†µã€‚
boolean onStartNestedScroll(@NonNull View child, @NonNull View target, @ScrollAxis int axes,
        @NestedScrollType int type);

// onStartNestedScrollè¿”å›trueåï¼Œå°±ä¼šè¢«è°ƒç”¨ï¼Œä¸€èˆ¬åœ¨è¿™é‡Œè®°å½•æ»šåŠ¨æ–¹å‘å’Œç±»å‹
void onNestedScrollAccepted(@NonNull View child, @NonNull View target, @ScrollAxis int axes,
        @NestedScrollType int type);

// childè°ƒç”¨dispatchNestedPreFlingåï¼Œä¼šè°ƒç”¨parentçš„æ­¤æ–¹æ³•
void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int[] consumed,
        @NestedScrollType int type);

// childè°ƒç”¨dispatchNestedScrollåï¼Œä¼šè°ƒç”¨parentçš„æ­¤æ–¹æ³•
void onNestedScroll(@NonNull View target, int dxConsumed, int dyConsumed, int dxUnconsumed,
        int dyUnconsumed, @ViewCompat.NestedScrollType int type, @NonNull int[] consumed);

// childè°ƒç”¨dispatchNestedPreFlingåï¼Œä¼šè°ƒç”¨parentçš„æ­¤æ–¹æ³•
boolean onNestedPreFling(@NonNull View target, float velocityX, float velocityY);

// childè°ƒç”¨dispatchNestedFlingåï¼Œä¼šè°ƒç”¨parentçš„æ­¤æ–¹æ³•
boolean onNestedFling(@NonNull View target, float velocityX, float velocityY, boolean consumed);

// childè°ƒç”¨stopNestedScrollåï¼Œä¼šè°ƒç”¨parentçš„æ­¤æ–¹æ³•
void onStopNestedScroll(@NonNull View target, @NestedScrollType int type);

// ä¸€èˆ¬å®ç°å°±æ˜¯è·å–onNestedScrollAcceptedä¸­è®°å½•çš„æ–¹å‘
@ScrollAxis
int getNestedScrollAxes();
```

### ä½¿ç”¨æµç¨‹
ç°åœ¨æˆ‘ä»¬æ¥å­¦ä¹ è¿™äº›æ¥å£æ˜¯å¦‚ä½•é…åˆä½¿ç”¨çš„ï¼Œä»¥åŠå®ƒä»¬çš„å®ç°å†…å®¹ï¼Œä»è€Œäº†è§£å¦‚ä½•å®ŒæˆåµŒå¥—æ»‘åŠ¨çš„é€šä¿¡ï¼ˆä»NestedScrollViewçš„å®ç°æµç¨‹ä¸­åˆ†æï¼‰ã€‚

1. ACTION_DOWNï¼šé¦–å…ˆåœ¨childçš„`ACTION_DOWN`æ—¶ï¼Œè°ƒç”¨`startNestedScroll`ï¼Œæ–¹å‘æ¯”å¦‚æ˜¯çºµå‘ï¼Œå› ä¸ºè¿™é‡Œæ˜¯è§¦æ‘¸å¼•å‘æ»‘åŠ¨ï¼Œæ‰€ä»¥ç±»å‹ä¼ å…¥TYPE_TOUCH
```
// downäº‹ä»¶æ—¶ï¼Œè®°å½•åˆå§‹Yåæ ‡ï¼Œå¹¶è°ƒç”¨startNestedScroll
int y = (int) ev.getY()
mLastMotionY = y
startNestedScroll(ViewCompat.SCROLL_AXIS_VERTICAL, ViewCompat.TYPE_TOUCH);
```

startNestedScrollçš„å†…å®¹ä¸€èˆ¬ä½¿ç”¨NestedScrollingChildHelperçš„å®ç°
```
public boolean startNestedScroll(@ScrollAxis int axes, @NestedScrollType int type) {
    if (hasNestedScrollingParent(type)) {
        // å·²ç»è°ƒç”¨è¿‡startNestedScrollï¼Œå°±è·³è¿‡
        return true;
    }
    // æ ¸å¿ƒå°±æ˜¯æ‰¾åˆ°onStartNestedScrollè¿”å›trueçš„ç›´æ¥æˆ–é—´æ¥parent
    if (isNestedScrollingEnabled()) {
        ViewParent p = mView.getParent();
        View child = mView;
        while (p != null) {
            if (ViewParentCompat.onStartNestedScroll(p, child, mView, axes, type)) {
                setNestedScrollingParentForType(type, p);//è®°å½•è¯¥parent
                ViewParentCompat.onNestedScrollAccepted(p, child, mView, axes, type);
                return true;
            }
            if (p instanceof View) {
                child = (View) p;
            }
            p = p.getParent();
        }
    }
    return false;
}
```
è¿™ä¸€æ­¥ä¹Ÿå°±æ˜¯è°ƒç”¨startNestedScrollï¼Œå¼•å‘é…åˆåµŒå¥—æ»‘åŠ¨çš„parentçš„onStartNestedScrollå’ŒonNestedScrollAcceptedå›è°ƒã€‚åµŒå¥—æ»šåŠ¨çš„childå’Œparentä¹‹é—´å»ºç«‹äº†å…³è”ï¼Œå¹¶è®¾ç½®äº†åµŒå¥—æ»šåŠ¨çš„çŠ¶æ€ã€‚
```
// ä¾‹å¦‚NestedScrollViewçš„å®ç°ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­æ˜¯çºµå‘æ»šåŠ¨å³å¯
public boolean onStartNestedScroll(@NonNull View child, @NonNull View target, int axes,
        int type) {
    return (axes & ViewCompat.SCROLL_AXIS_VERTICAL) != 0;
}

// onNestedScrollAcceptedä¸€èˆ¬ä½¿ç”¨NestedScrollingParentHelperçš„å®ç°ï¼Œå³è®°å½•æ»šåŠ¨çš„æ–¹å‘
public void onNestedScrollAccepted(@NonNull View child, @NonNull View target,
        @ScrollAxis int axes, @NestedScrollType int type) {
    if (type == ViewCompat.TYPE_NON_TOUCH) {
        mNestedScrollAxesNonTouch = axes;
    } else {
        mNestedScrollAxesTouch = axes;
    }
}
```

2. ACTION_MOVEï¼šä¸€èˆ¬åµŒå¥—æ»šåŠ¨çš„childçš„`ACTION_MOVE`æ—¶ï¼Œä¼šè§¦å‘æ»šåŠ¨ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæ»šåŠ¨å‰å…ˆè°ƒç”¨`dispatchNestedPreScroll`ï¼š
```
int[] mScrollConsumed = new int[2];

int y = ev.getY();
int deltaY = mLastMotionY - y;

if (dispatchNestedPreScroll(0, deltaY, mScrollConsumed, mScrollOffset,
        ViewCompat.TYPE_TOUCH)) {
    deltaY -= mScrollConsumed[1];
}
mLastMotionY = y - mScrollOffset[1];
```

`dispatchNestedPreScroll`é‡‡ç”¨NestedScrollingChildHelperçš„å®ç°ï¼Œè¿”å›trueï¼Œè¡¨ç¤ºparentæ¶ˆè´¹äº†éƒ¨åˆ†æˆ–å…¨éƒ¨æ»šåŠ¨è·ç¦»ï¼š
```
public boolean dispatchNestedPreScroll(int dx, int dy, @Nullable int[] consumed,
        @Nullable int[] offsetInWindow, @NestedScrollType int type) {
    if (isNestedScrollingEnabled()) {
        final ViewParent parent = getNestedScrollingParentForType(type);
        if (parent == null) {
            return false;
        }
        if (dx != 0 || dy != 0) {
            int startX = 0;
            int startY = 0;
            // è®°å½•childçš„åŸæœ¬ä½ç½®
            if (offsetInWindow != null) {
                mView.getLocationInWindow(offsetInWindow);
                startX = offsetInWindow[0];
                startY = offsetInWindow[1];
            }
            if (consumed == null) {
                consumed = getTempNestedScrollConsumed();
            }
            consumed[0] = 0;
            consumed[1] = 0;
            ViewParentCompat.onNestedPreScroll(parent, mView, dx, dy, consumed, type);
            // æ ¹æ®childçš„åŸæœ¬ä½ç½®å’Œç°ä½ç½®ï¼Œè®¡ç®—å‡ºç»è¿‡parentçš„onNestedPreScrollåå¯¼è‡´çš„åç§»ï¼Œchildå¯ä»¥ç”¨è¿™ä¸ªæ•°æ®æ¥è°ƒæ•´è‡ªå·±å†…éƒ¨çš„æ»‘åŠ¨åæ ‡è®¡ç®—ï¼Œæ¯”å¦‚æ»‘åŠ¨é€Ÿåº¦ã€è·ç¦»
            if (offsetInWindow != null) {
                mView.getLocationInWindow(offsetInWindow);
                offsetInWindow[0] -= startX;
                offsetInWindow[1] -= startY;
            }
            return consumed[0] != 0 || consumed[1] != 0;
        } else if (offsetInWindow != null) {
            offsetInWindow[0] = 0;
            offsetInWindow[1] = 0;
        }
    }
    return false;
}
```
dxå’Œdyè¡¨ç¤ºå‡†å¤‡æ»šåŠ¨çš„è·ç¦»ï¼Œconsumedæ•°ç»„ä¼ ç»™parentï¼Œç”¨äºparentå‘Šè¯‰childï¼Œparentæ¶ˆè´¹äº†å¤šå°‘è·ç¦»ã€‚ä»£ç ä¸­é™¤äº†offsetInWindowè¿™ä¸ªåç§»é‡è®¡ç®—çš„é€»è¾‘ï¼Œå…¶å®ä¸»è¦å°±æ˜¯è°ƒç”¨parentçš„`onNestedPreScroll`ï¼Œä»¥NestedScrollViewä¸ºä¾‹ï¼š
```
// NestedScrollViewåªæ˜¯ç®€å•çš„å†åˆ†å‘åˆ°parentï¼Œè‡ªå·±ä¸ä¼šæ¶ˆè´¹ï¼Œå› ä¸ºNestedScrollViewæ”¯æŒå¤šå±‚åµŒå¥—
public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int[] consumed,
        int type) {
    dispatchNestedPreScroll(dx, dy, consumed, null, type);
}
```

childè°ƒç”¨å®Œ`dispatchNestedPreScroll`åï¼Œä¹Ÿå°±ç»è¿‡äº†parentå¯èƒ½çš„æ¶ˆè´¹å¤„ç†ï¼Œç°åœ¨è‡ªå·±å°±å¯ä»¥æ ¹æ®å‰©ä½™çš„æ»šåŠ¨è·ç¦»ï¼Œè‡ªå·±æ¥æ»šåŠ¨ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬çœç•¥ã€‚è‡ªå·±æ»šåŠ¨å®Œåï¼Œåˆ™åº”è¯¥è°ƒç”¨`dispatchNestedScroll`æ¥å‘Šè¯‰parentï¼Œè‡ªå·±çš„æ»šåŠ¨æƒ…å†µï¼š
```
// å‘Šè¯‰parentçš„ä¿¡æ¯ï¼Œæ ¹æ®å‚æ•°å¯çŸ¥ï¼Œæ¯”å¦‚scrolledDeltaYè¡¨ç¤ºchildæ»šåŠ¨äº†å¤šå°‘ï¼ŒunconsumedYè¡¨ç¤ºè¿˜æœ‰å¤šå°‘æ²¡æœ‰æ¶ˆè´¹ï¼Œæ¯”å¦‚childå·²ç»æ»šåˆ°é¡¶éƒ¨äº†
dispatchNestedScroll(0, scrolledDeltaY, 0, unconsumedY, mScrollOffset,
                            ViewCompat.TYPE_TOUCH, mScrollConsumed);
```
`dispatchNestedScroll`åŒæ ·æ˜¯ä½¿ç”¨NestedScrollingChildHelperçš„å®ç°ï¼Œå®ƒå’Œ`dispatchNestedPreScroll`çš„å®ç°ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯è¿™æ¬¡è°ƒç”¨çš„æ˜¯parentçš„`onNestedScroll`ï¼š
```
// NestedScrollViewçš„å®ç°ï¼Œå°±æ˜¯è‡ªå·±æ¥æ»šåŠ¨childä¸èƒ½æ¶ˆè´¹çš„è·ç¦»
public void onNestedScroll(@NonNull View target, int dxConsumed, int dyConsumed,
        int dxUnconsumed, int dyUnconsumed, int type, @NonNull int[] consumed) {
    onNestedScrollInternal(dyUnconsumed, type, consumed);
}
private void onNestedScrollInternal(int dyUnconsumed, int type, @Nullable int[] consumed) {
    final int oldScrollY = getScrollY();
    scrollBy(0, dyUnconsumed);
    final int myConsumed = getScrollY() - oldScrollY;
    if (consumed != null) {
        consumed[1] += myConsumed;
    }
    final int myUnconsumed = dyUnconsumed - myConsumed;
    // å› ä¸ºæ”¯æŒå¤šå±‚åµŒå¥—ï¼Œæ‰€ä»¥parentä¹Ÿä¼šä½œä¸ºchildæ¥é€šçŸ¥è‡ªå·±çš„parent
    mChildHelper.dispatchNestedScroll(0, myConsumed, 0, myUnconsumed, null, type, consumed);
}
```
è¿™é‡Œå…¶å®å¯ä»¥çœ‹å‡ºæ¥ï¼Œchildä¸èƒ½æ¶ˆè´¹ï¼Œparentæ¥æ¶ˆè´¹ï¼Œå°±å¯¹åº”äº†childæ»‘åŠ¨é¡¶éƒ¨æˆ–åº•éƒ¨ï¼Œç»§ç»­æ»‘åŠ¨æ—¶ï¼Œparentå°±ä¼šå¼€å§‹æ»šåŠ¨çš„è¿™ç§äº¤äº’åœºæ™¯ã€‚

3. ACTION_UP/ACTION_CANCELï¼šæ¾æ‰‹çš„æ—¶å€™ï¼Œå¯¹åº”åˆ°flingæƒ¯æ€§æ»šåŠ¨ï¼Œä¸€èˆ¬æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼ˆcancelåªç»“æŸï¼Œä¸æƒ¯æ€§æ»šåŠ¨ï¼‰ã€‚
```
int initialVelocity = (int) velocityTracker.getYVelocity(mActivePointerId);

if (!dispatchNestedPreFling(0, -initialVelocity)) {
    dispatchNestedFling(0, -initialVelocity, true);
    fling(-initialVelocity);
}

stopNestedScroll(ViewCompat.TYPE_TOUCH);
```
`dispatchNestedPreFling`å¼•å‘è°ƒç”¨åµŒå¥—æ»šåŠ¨parentçš„`onNestedPreFling`ï¼ŒNestedScrollViewçš„å®ç°åªæ˜¯å†å¾€ä¸ŠåµŒå¥—è½¬å‘ï¼Œå¦‚æœä¸Šå±‚æ²¡æœ‰åµŒå¥—parentï¼Œå°±è¿”å›falseäº†ã€‚æ‰€ä»¥ä¸€èˆ¬ä¼šç»§ç»­æ‰§è¡Œ`dispatchNestedFling`ï¼Œå¼•å‘åµŒå¥—æ»šåŠ¨parentè°ƒç”¨`onNestedFling`ã€‚`dispatchNestedFling`çš„å‰ä¸¤ä¸ªå‚æ•°ä¸ºxå’Œyè½´çš„é€Ÿåº¦ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å‘Šè¯‰parentï¼Œè‡ªå·±æ˜¯å¦å·²ç»æ¶ˆè´¹äº†flingã€‚
```
// NestedScrollViewä½œä¸ºparentï¼Œå¦‚æœchildä¼ çš„consumedä¸ºfalseï¼Œè¡¨ç¤ºchildæ²¡æœ‰æ¶ˆè´¹flingï¼Œé‚£ä¹ˆparentå°±ä¼šæ¶ˆè´¹
public boolean onNestedFling(
        @NonNull View target, float velocityX, float velocityY, boolean consumed) {
    if (!consumed) {
        dispatchNestedFling(0, velocityY, true);
        fling((int) velocityY);
        return true;
    }
    return false;
}
```

#### æƒ¯æ€§ä¼ é€’
åœ¨æƒ¯æ€§æ»‘åŠ¨ä¸­ï¼Œchildå¦‚æœæƒ¯æ€§æ»‘åŠ¨åˆ°äº†é¡¶éƒ¨ï¼Œåº”è¯¥è¿˜éœ€è¦ä¼ é€’åˆ°parentç»§ç»­æƒ¯æ€§æ»šåŠ¨ï¼Œflingä¸€èˆ¬æ˜¯ä½¿ç”¨Scrollerï¼Œæ‰€ä»¥è¿˜éœ€è¦åœ¨`computeScroll()`æ–¹æ³•ä¸­ï¼Œç»§ç»­ä½¿ç”¨`dispatchNestedPreScroll`å’Œ`dispatchNestedScroll`ï¼Œé€»è¾‘å’Œ`ACTION_MOVE`ä¸­ç±»ä¼¼ï¼Œä½†ä¸åŒæ˜¯ï¼Œä¹‹å‰ä½¿ç”¨çš„æ»šåŠ¨ç±»å‹éƒ½æ˜¯`TYPE_TOUCH`ï¼Œä¸ºäº†åŒºåˆ†ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨`TYPE_NON_TOUCH`ã€‚

> `startNestedScroll`å’Œ`stopNestedScroll`åœ¨onInterceptTouchEventå’ŒonTouchEventæ–¹æ³•çš„downå’Œup/cancelæœ€å¥½åˆ†åˆ«éƒ½è°ƒç”¨ï¼Œ`stopNestedScroll`è¿˜åº”è¯¥åœ¨`computeScroll()`åˆ¤æ–­æƒ¯æ€§æ»‘åŠ¨ç»“æŸæ—¶è°ƒç”¨ã€‚`startNestedScroll`å’Œ`stopNestedScroll`éƒ½åšäº†å¤šæ¬¡è°ƒç”¨è·³è¿‡çš„é€»è¾‘ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒå¤šæ¬¡è°ƒç”¨ã€‚å¤šæ¬¡è°ƒç”¨çš„åŸå› ï¼Œæˆ‘è®¤ä¸ºæ˜¯onInterceptTouchEventå’ŒonTouchEventåœ¨æŸäº›æƒ…å†µåªä¼šè°ƒç”¨ä¸€ä¸ªï¼Œæ¯”å¦‚æ²¡æœ‰æ‹¦æˆªchildçš„äº‹ä»¶ï¼Œå°±åªä¼šè°ƒç”¨è‡ªå·±çš„onInterceptTouchEventï¼Œä¸ä¼šè°ƒç”¨onTouchEventï¼Œä¸¤å¤„éƒ½è°ƒç”¨æ›´ä¸ºä¿é™©ã€‚

#### ä½¿ç”¨æ€»ç»“
* ğŸ‘‡ ç”¨æˆ·è§¦æ‘¸å±å¹•ï¼šåœ¨ACTION_DOWNäº‹ä»¶ä¸­ï¼Œviewå°†è°ƒç”¨startNestedScroll()ï¼Œç”±è¿‘åˆ°è¿œæ‰¾åˆ°è¿”å› true çš„parentï¼Œè¿”å› true æ„å‘³ç€parentå¯¹è¿™ä¸ªåµŒå¥—æ»šåŠ¨æ„Ÿå…´è¶£ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•å±‚çº§çš„parentè¿”å› trueï¼Œåˆ™åµŒå¥—æ»šåŠ¨å°†è¢«å–æ¶ˆï¼Œviewå°†æŒ‰æ™®é€šæ»šåŠ¨æ¥å®Œæˆå·¥ä½œã€‚æ­¤æ—¶åº”è¯¥ä½¿ç”¨TYPE_TOUCHã€‚

* ğŸ‘‹ ç”¨æˆ·ç§»åŠ¨æ‰‹æŒ‡ï¼šåœ¨æ¯ä¸ªACTION_MOVEäº‹ä»¶ä¸Šï¼Œviewå°†è°ƒç”¨dispatchNestedPreScroll()å‘åµŒå¥—æ»šåŠ¨çš„parentå‘é€äº‹ä»¶ï¼Œå…è®¸å®ƒæ¶ˆè´¹æ‰‹æŒ‡ç§»åŠ¨çš„ä»»æ„è·ç¦»ã€‚å¦‚æœçˆ¶çº§æ²¡æœ‰æ¶ˆè´¹å®Œæ‰€æœ‰è·ç¦»ï¼Œåˆ™viewæœ¬èº«æ¶ˆè´¹å‰©ä½™éƒ¨åˆ†ï¼ˆé€šè¿‡æ»šåŠ¨ä½ç½®ç­‰æ–¹å¼ï¼‰å¹¶è°ƒç”¨dispatchNestedScroll()å‘Šè¯‰parentï¼Œchildæ¶ˆè´¹çš„æƒ…å†µï¼Œparentæ­¤æ—¶å¯ä»¥å†æ¬¡ä»‹å…¥å¤„ç†ã€‚

* ğŸ‘† ç”¨æˆ·æŠ¬èµ·æ‰‹æŒ‡ï¼šåœ¨ACTION_UPäº‹ä»¶ï¼Œviewä¼šè®¡ç®—æ˜¯å¦éœ€è¦é€šè¿‡flingç»§ç»­æ»šåŠ¨ï¼Œå¦‚æœæ‰‹åŠ¿ä¸­æœ‰è¶³å¤Ÿçš„é€Ÿåº¦ï¼Œå®ƒå°†è°ƒç”¨dispatchNestedPreFling()ä»¥å…è®¸åµŒå¥—æ»šåŠ¨çš„parentæ¥æ¶ˆè´¹é€Ÿåº¦ã€‚å¦‚æœparentè¿”å› true ï¼ˆè¡¨ç¤ºæ¶ˆè´¹äº†é€Ÿåº¦ï¼‰ï¼Œåˆ™viewç»“æŸæ»šåŠ¨ä»»åŠ¡ã€‚å¦åˆ™ï¼Œviewè‡ªå·±å°†å¼€å§‹flingï¼Œå¹¶è°ƒç”¨dispatchNestedFling()ï¼Œå‘Šè¯‰parentæ­¤æƒ…å†µã€‚å¹¶ä¸”childä¼šè°ƒç”¨stopNestedScroll(TYPE_TOUCH)å°†åµŒå¥—æ»šåŠ¨æ ‡è®°ä¸ºå®Œæˆï¼Œå³ä½¿viewå®é™…ä¸Šå¯èƒ½æ­£åœ¨flingã€‚ACTION_CANCElçš„æƒ…å†µå°±è°ƒç”¨stopNestedScrollå³å¯ã€‚

* ğŸ¢ å¼€å§‹flingï¼šæœ€åï¼Œå¦‚æœè§†å›¾å¼€å§‹ä½¿ç”¨flingè‡ªè¡Œæ»šåŠ¨ï¼Œæˆ‘ä»¬ç°åœ¨å°†å¼€å§‹æ–°ä¸€è½®çš„åµŒå¥—æ»šåŠ¨ï¼Œä½†è¿™æ¬¡ä½¿ç”¨`TYPE_NON_TOUCH`ç±»å‹ã€‚startNestedScroll(TYPE_NON_TOUCH)ï¼Œç„¶åæ˜¯dispatchNestedPreScroll(TYPE_NON_TOUCH)+ dispatchNestedScroll(TYPE_NON_TOUCH)ï¼Œæœ€åæ˜¯stopNestedScroll(TYPE_NON_TOUCH)ã€‚è¿™ä¸€æ¬¡åµŒå¥—æ»šåŠ¨æµç¨‹ï¼Œéƒ½æ˜¯ç”±è§†å›¾çš„ flingï¼ˆé€šå¸¸æ˜¯Scrollerï¼‰è€Œä¸æ˜¯è§¦æ‘¸äº‹ä»¶é©±åŠ¨çš„ã€‚


|äº‹ä»¶ç±»å‹|åµŒå¥—æ»šåŠ¨child|åµŒå¥—æ»šåŠ¨parent|
|--|--|--|
|ACTION_DOWN|startNestedScroll(TYPE_TOUCH)|onStartNestedScroll<p>onNestedScrollAccepted|
|ACTION_MOVE|dispatchNestedPreScroll(TYPE_TOUCH)<p>dispatchNestedScroll(TYPE_TOUCH)|onNestedPreScroll<p>onNestedScroll|
|ACTION_UP|dispatchNestedPreFling(TYPE_TOUCH)<p>dispatchNestedFling(TYPE_TOUCH)<p>stopNestedScroll(TYPE_TOUCH)|onNestedPreFling<p>onNestedFling|
|computeScroll|dispatchNestedPreScroll(TYPE_NON_TOUCH)<p>dispatchNestedScroll(TYPE_NON_TOUCH)<p>stopNestedScroll(TYPE_NON_TOUCH)|onNestedPreScroll<p>onNestedScroll|

### ç‰ˆæœ¬å†å²å˜åŒ–
* NestedScrollingChild2(parent2é…å¥—) åŠ ä¸ŠTYPE_NON_TOUCHï¼Œå®ç°äº†åµŒå¥—flingçš„ä¼ é€’
* NestedScrollingChild3(parent3é…å¥—) ç»™åŸæ¥çš„dispatchNestedScroll()å’ŒonNestedScroll()å¢åŠ äº†int[] consumedå‚æ•°ï¼Œå¯ä»¥åœ¨æƒ¯æ€§ä¼ é€’çš„æƒ…å†µä¸‹ï¼Œè®©childçŸ¥é“parentæ¶ˆè´¹çš„é‡ï¼Œå¦‚æœè‡ªå·±å’Œparentéƒ½æ²¡æœ‰æ¶ˆè´¹äº†ï¼Œè¯´æ˜éƒ½åˆ°é¡¶éƒ¨äº†ï¼Œå°±è¦åœæ­¢æ»šåŠ¨

### å®ç°çš„å…³æ³¨ç‚¹
ä½œä¸ºchildï¼Œå°±æ˜¯å¦‚ä¸Šé¢åœ¨åˆé€‚çš„ä½ç½®è°ƒç”¨`NestedScrollingChild`æ¥å£çš„æ–¹æ³•ï¼Œå®ç°å†…å®¹ä½¿ç”¨`NestedScrollingChildHelper`ã€‚ä½†ä¸€èˆ¬æƒ…å†µï¼ŒåµŒå¥—æ»šåŠ¨çš„childéƒ½æ˜¯ä½¿ç”¨ç°æˆçš„æ§ä»¶ã€‚

åœ¨åµŒå¥—æ»‘åŠ¨ä¸­ï¼Œæˆ‘ä»¬æ›´å¤šçš„æƒ…å†µï¼Œæ˜¯è‡ªå®šä¹‰parentï¼Œå› ä¸º`NestedScrollingParentHelper`å¸®æˆ‘ä»¬å®ç°äº†`onNestedScrollAccepted`ã€`getNestedScrollAxeson`å’Œ`StopNestedScroll`æ–¹æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸ç”¨é‡å†™ï¼Œæˆ‘ä»¬å¤§éƒ½åªéœ€è¦å®ç°å¦‚ä¸‹æ–¹æ³•ï¼š
```
onStartNestedScroll
onNestedPreScroll
onNestedScroll
onNestedPreFling
onNestedFling
```
> parentåœ¨æ¶ˆè´¹è·ç¦»ï¼ˆæ¶ˆè´¹è·ç¦»0ä¹Ÿè¡Œï¼‰æ—¶ï¼Œè¿˜å¯ä»¥åšä¸€äº›ç‰¹å®šæ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›‘å¬åˆ°childçš„æ»‘åŠ¨ä»è€Œå¯¹ä¸€äº›æ§ä»¶æ”¹å˜é€æ˜åº¦ï¼Œæˆ–è€…å…¶ä»–æ“ä½œã€‚

> ListViewï¼ŒScrollViewç­‰æ§ä»¶åœ¨5.0ä»¥ä¸‹ç‰ˆæœ¬æ²¡æœ‰å®ç°è¿™äº›æ¥å£ï¼Œæœ€å¥½ä½¿ç”¨RecyclerViewæˆ–è€…NestedScrollViewï¼Œä¸ç„¶å°±è¦è‡ªè¡Œå®ç°äº†

å‚è€ƒï¼š
* https://chris.banes.dev/carry-on-scrolling/
* https://juejin.cn/post/6844903761060577294

> NestedScrollViewåœ¨onInterceptTouchEventä¸­ï¼Œé€šè¿‡getNestedScrollAxesåˆ¤æ–­äº†å¤„äºåµŒå¥—æ»šåŠ¨ï¼Œé¿å…æ‹¦æˆªå­viewçš„äº‹ä»¶ï¼Œä½†RecyclerlViewåªå®ç°äº†NestedScrollingChildï¼Œè€Œæ²¡æœ‰å®ç°NestedScrollingParentï¼Œæ‰€ä»¥RecyclerViewä½œä¸ºåµŒå¥—æ»šåŠ¨çš„çˆ¶çº§ä»æœ‰é—®é¢˜ï¼Œä¾‹å¦‚ViewPager2åŸºäºRecyclerViewï¼Œæ‰€ä»¥ä½œä¸ºåµŒå¥—æ»šåŠ¨çš„çˆ¶çº§éœ€è¦é¢å¤–å¤„ç†ã€‚å¯å‚è€ƒå®˜æ–¹çš„ä»£ç  NestedScrollableHost

> ViewPager2å†…éƒ¨ä¸ºçºµå‘RecyclerViewã€å¤–éƒ¨ä¸ºBottomSheetBehaviorçš„æƒ…å†µï¼Œæƒ³è¦çºµå‘åµŒå¥—æ»šåŠ¨ï¼šBottomSheetBehaviorä¼šæŸ¥æ‰¾æœ€è¿‘çš„å­çº§`isNestedScrollingEnabled`ä¸ºtrueçš„viewä½œä¸ºåµŒå¥—æ»‘åŠ¨çš„childï¼ˆå¯æŸ¥çœ‹æºç `nestedScrollingChildRef`å­—æ®µï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦å¤–å±‚çš„BottomSheetBehaviorå’Œå†…å±‚é¢„è®¾åˆ—è¡¨RecyclerViewä¹‹é—´åµŒå¥—æ»‘åŠ¨ï¼Œé¦–å…ˆè¦è®¾ç½®ViewPager2å†…çš„RecyclerViewçš„`isNestedScrollingEnabled`ä¸ºfalseï¼Œå±è”½ä¸­é—´å±‚ã€‚ç„¶åè¿˜éœ€è¦è®©BottomSheetBehavioræŸ¥æ‰¾åˆ°ViewPager2å½“å‰é¡µé¢çš„é¢„è®¾åˆ—è¡¨RecyclerViewï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ViewPager2åˆ‡æ¢é¡µé¢æ—¶ï¼Œè®¾ç½®å½“å‰é¡µé¢çš„RecyclerViewçš„`isNestedScrollingEnabled`ä¸ºtrueï¼Œå…¶ä»–é¡µé¢çš„RecyclerView`isNestedScrollingEnabled`ä¸ºfalseï¼Œè¿™æ ·å°±ä¼šè®©BottomSheetBehaviorä»¥å½“å‰é¡µé¢çš„RecyclerViewä¸ºåµŒå¥—æ»‘åŠ¨çš„childã€‚å¦å¤–ï¼Œå› ä¸ºè¿˜éœ€è¦è§¦å‘BottomSheetBehaviorçš„`onLayoutChild`æ–¹æ³•æ‰ä¼šæ‰§è¡ŒæŸ¥æ‰¾åµŒå¥—æ»‘åŠ¨å­çº§ï¼Œå¦åˆ™åµŒå¥—æ»‘åŠ¨çš„childåœ¨ViewPager2åˆ‡æ¢é¡µé¢æ—¶æ²¡æœ‰æ›´æ–°ä¸ºå½“å‰é¡µé¢ï¼Œæ‰€ä»¥è¿˜éœ€è¦è°ƒç”¨CoordinatorLayoutçš„requestLayout()ã€‚

## CoordinatorLayoutå’Œbehavior
åµŒå¥—æ»‘åŠ¨æœ¬è´¨ä¸Šæ˜¯viewä¹‹é—´ç›¸äº’é€šä¿¡ã€åè°ƒã€‚CoordinatorLayoutæ˜¯NestedScrollingParentçš„å­ç±»ï¼Œå¹¶ä¸”è¿˜ä»‹å…¥äº†å¸ƒå±€æµç¨‹ã€äº‹ä»¶åˆ†å‘ç­‰ï¼Œç›¸å½“äºæŠŠåµŒå¥—æ»‘åŠ¨çš„åè°ƒæ€æƒ³ï¼Œæ‰©å±•åˆ°äº†å¸ƒå±€æµç¨‹ã€äº‹ä»¶åˆ†å‘ç­‰ã€‚CoordinatorLayoutä½œä¸ºåµŒå¥—æ»‘åŠ¨çš„parentã€å¸ƒå±€æµç¨‹ã€äº‹ä»¶åˆ†å‘çš„ä¸­é—´åè°ƒè€…ï¼Œå¯ä»¥è§£è€¦CoordinatorLayoutçš„å„ä¸ªchildä¹‹é—´çš„åè°ƒæ“ä½œã€‚è¿™éƒ¨åˆ†æˆ‘ä»¬åœ¨å•ç‹¬çš„æ–‡ç« ä¸­ä»‹ç»ã€‚